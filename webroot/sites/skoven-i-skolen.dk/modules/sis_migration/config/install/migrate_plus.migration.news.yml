id: news
label: News
migration_tags: {}
migration_group: migrate

source:
  plugin: d7_node
  node_type: sis_news
  key: migrate

process:
  title: title
  created: created
  updated: updated
  'body/format':
    plugin: default_value
    default_value: basic_html
  'body/value':
    -
      plugin: skip_on_empty
      method: process
      source: field_sis_news_body/0/value
    -
      plugin: str_replace
      search: '/sites/default/files/'
      replace: '/sites/skoven-i-skolen.dk/files/'
      source: field_sis_news_body/0/value
  'body/summary': field_sis_news_body/0/summary
  field_list_date:
    plugin: format_date
    from_format: 'U'
    to_format: 'Y-m-d\TH:i:s'
    source: created
  field_description: field_sis_news_body/0/summary
  field_list_media:
    - plugin: skip_on_empty
      method: process
      source: field_sis_news_image/0/fid
    -
      plugin: migration_lookup
      migration: upgrade_d7_file_to_media_image
      source: field_sis_news_image/0/fid
      no_stub: true
  field_news_image:
    - plugin: skip_on_empty
      method: process
      source: field_sis_news_image/0/fid
    - plugin: migration_lookup
      migration: upgrade_d7_file_to_media_image
      source: field_sis_news_image/0/fid
      no_stub: true
destination:
  plugin: entity:node
  default_bundle: news
migration_dependencies:
  required:
    - upgrade_d7_file_to_media_image
    - upgrade_d7_file_to_media_document
    - upgrade_d7_file_to_media_audio
